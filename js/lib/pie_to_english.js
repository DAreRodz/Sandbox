// Copyright 2013-2014 The Phonetically Intuitive English Project.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

function pie_to_english(pie)
{
	var uncombineMap = {

		// silences

		"\u0226": "A",
		"\u0227": "a",
		"\u0243": "B",
		"\u0180": "b",
		"\u010a": "C",
		"\u010b": "c",
		"\u0110": "D",
		"\u0111": "d",
		"\u0116": "E",
		"\u0117": "e",
		"\u1e1e": "F",
		"\u1e1f": "f",
		"\u01e4": "G",
		"\u01e5": "g",
		"\u0126": "H",
		"\u0127": "h",
		"\u0268": "i",
		"\u0197": "I",
		"\u0248": "J",
		"\u0249": "j",
		"\ua740": "K",
		"\ua741": "k",
		"\u019a": "l",
		"\u023d": "L",
		"\u022e": "O",
		"\u022f": "o",
		"\u2c63": "P",
		"\u1d7d": "p",
		"\u1e56": "P",
		"\u1e57": "p",
		"\ua756": "Q",
		"\ua757": "q",
		"\u024c": "R",
		"\u024d": "r",
		"\u1e60": "S",
		"\u1e61": "s",
		"\u0166": "T",
		"\u0167": "t",
		"\u0244": "U",
		"\u0289": "u",
		"\u024e": "Y",
		"\u024f": "y",
		"\u01b5": "Z",
		"\u01b6": "z",

		// ?

		"\u1ec8": "I",
		"\u1ec9": "i",
		"\u1ece": "O",
		"\u1ecf": "o",

		// )

		"\u1e9a": "a",

		// stress

		"\u1ea0": "A",
		"\u1ea1": "a",
		"\u1eb8": "E",
		"\u1eb9": "e",
		"\u1eca": "I",
		"\u1ecb": "i",
		"\u1ecc": "O",
		"\u1ecd": "o",
		"\u1ee4": "U",
		"\u1ee5": "u",
		"\u1e88": "W",
		"\u1e89": "w",
		"\u1ef4": "Y",
		"\u1ef5": "y",
		"\u1e5a": "R",
		"\u1e5b": "r",

		// /

		"\u00c1": "A",
		"\u00e1": "a",
		"\u00c9": "E",
		"\u00e9": "e",
		"\u00cd": "I",
		"\u00ed": "i",
		"\u00d3": "O",
		"\u00f3": "o",
		"\u00da": "U",
		"\u00fa": "u",
		"\u00dd": "Y",
		"\u00fd": "y",

		// o

		"\u00c5": "A",
		"\u00e5": "a",

		// ^

		"\u00c2": "A",
		"\u00e2": "a",
		"\u00ca": "E",
		"\u00ea": "e",
		"\u00d4": "O",
		"\u00f4": "o",

		// u

		"\u0102": "A",
		"\u0103": "a",
		"\u0114": "E",
		"\u0115": "e",
		"\u014e": "O",
		"\u014f": "o",
		"\u016c": "U",
		"\u016d": "u",

		// n

		"\u0206": "E",
		"\u0207": "e",
		"\u020e": "O",
		"\u020f": "o",
		"\u0216": "U",
		"\u0217": "u",

		// -

		"\u0100": "A",
		"\u0101": "a",
		"\u0112": "E",
		"\u0113": "e",
		"\u1e20": "G",
		"\u1e21": "g",
		"\u012a": "I",
		"\u012b": "i",
		"\u014c": "O",
		"\u014d": "o",
		"\u016a": "U",
		"\u016b": "u",
		"\u0232": "Y",
		"\u0233": "y",

		// ..

		"\u00c4": "A",
		"\u00e4": "a",
		"\u00cb": "E",
		"\u00eb": "e",
		"\u00cf": "I",
		"\u00ef": "i",
		"\u00d6": "O",
		"\u00f6": "o",
		"\u00dc": "U",
		"\u00fc": "u",
		"\u1e84": "W",
		"\u1e85": "w",
		"\u0178": "Y",
		"\u00ff": "y",

		// \\

		"\u0200": "A",
		"\u0201": "a",
		"\u0204": "E",
		"\u0205": "e",
		"\u0214": "U",
		"\u0215": "u",

		// //

		"\u0150": "O",
		"\u0151": "o",

		// \

		"\u00c0": "A",
		"\u00e0": "a",
		"\u00c8": "E",
		"\u00e8": "e",
		"\u00cc": "I",
		"\u00ec": "i",
		"\u00d2": "O",
		"\u00f2": "o",
		"\u00d9": "U",
		"\u00f9": "u",
		"\u1e80": "W",
		"\u1e81": "w",
		"\u1ef2": "Y",
		"\u1ef3": "y",

		// ) below

		"\u00c7": "C",
		"\u00e7": "c",
		"\u015e": "S",
		"\u015f": "s",
		"\u0162": "T",
		"\u0163": "t",

		// - below

		"\u1e6e": "T",
		"\u1e6f": "t",
		"\u1e94": "Z",
		"\u1e95": "z"
	};

	function restoreString(s) {
		if (/[\u00b7\u2027]/.test(s)==true)
			s=s.replace(/([A-Za-z\u0300-\u036f\u0226\u0227\u0243\u0180\u010a\u010b\u0110\u0111\u0116\u0117\u1e1e\u1e1f\u01e4\u01e5\u0126\u0127\u0268\u0197\u0248\u0249\ua740\ua741\u019a\u023d\u022e\u022f\u2c63\u1d7d\u1e56\u1e57\ua756\ua757\u024c\u024d\u1e60\u1e61\u0166\u0167\u0244\u0289\u024e\u024f\u01b5\u01b6\u1ec8\u1ec9\u1ece\u1ecf\u1e9a\u1ea0\u1ea1\u1eb8\u1eb9\u1eca\u1ecb\u1ecc\u1ecd\u1ee4\u1ee5\u1e88\u1e89\u1ef4\u1ef5\u1e5a\u1e5b\u00c1\u00e1\u00c9\u00e9\u00cd\u00ed\u00d3\u00f3\u00da\u00fa\u00dd\u00fd\u00c5\u00e5\u00c2\u00e2\u00ca\u00ea\u00d4\u00f4\u0102\u0103\u0114\u0115\u014e\u014f\u016c\u016d\u0206\u0207\u020e\u020f\u0216\u0217\u0100\u0101\u0112\u0113\u1e20\u1e21\u012a\u012b\u014c\u014d\u016a\u016b\u0232\u0233\u00c4\u00e4\u00cb\u00eb\u00cf\u00ef\u00d6\u00f6\u00dc\u00fc\u1e84\u1e85\u0178\u00ff\u0200\u0201\u0204\u0205\u0214\u0215\u0150\u0151\u00c0\u00e0\u00c8\u00e8\u00cc\u00ec\u00d2\u00f2\u00d9\u00f9\u1e80\u1e81\u1ef2\u1ef3\u00c7\u00e7\u015e\u015f\u0162\u0163\u1e6e\u1e6f\u1e94\u1e95]+)[\u00b7\u2027]([A-Za-z\u0300-\u036f\u0226\u0227\u0243\u0180\u010a\u010b\u0110\u0111\u0116\u0117\u1e1e\u1e1f\u01e4\u01e5\u0126\u0127\u0268\u0197\u0248\u0249\ua740\ua741\u019a\u023d\u022e\u022f\u2c63\u1d7d\u1e56\u1e57\ua756\ua757\u024c\u024d\u1e60\u1e61\u0166\u0167\u0244\u0289\u024e\u024f\u01b5\u01b6\u1ec8\u1ec9\u1ece\u1ecf\u1e9a\u1ea0\u1ea1\u1eb8\u1eb9\u1eca\u1ecb\u1ecc\u1ecd\u1ee4\u1ee5\u1e88\u1e89\u1ef4\u1ef5\u1e5a\u1e5b\u00c1\u00e1\u00c9\u00e9\u00cd\u00ed\u00d3\u00f3\u00da\u00fa\u00dd\u00fd\u00c5\u00e5\u00c2\u00e2\u00ca\u00ea\u00d4\u00f4\u0102\u0103\u0114\u0115\u014e\u014f\u016c\u016d\u0206\u0207\u020e\u020f\u0216\u0217\u0100\u0101\u0112\u0113\u1e20\u1e21\u012a\u012b\u014c\u014d\u016a\u016b\u0232\u0233\u00c4\u00e4\u00cb\u00eb\u00cf\u00ef\u00d6\u00f6\u00dc\u00fc\u1e84\u1e85\u0178\u00ff\u0200\u0201\u0204\u0205\u0214\u0215\u0150\u0151\u00c0\u00e0\u00c8\u00e8\u00cc\u00ec\u00d2\u00f2\u00d9\u00f9\u1e80\u1e81\u1ef2\u1ef3\u00c7\u00e7\u015e\u015f\u0162\u0163\u1e6e\u1e6f\u1e94\u1e95]+)/g, function (str, p1, p2) {
				if (/[\u0300-\u036f\u0226\u0227\u0243\u0180\u010a\u010b\u0110\u0111\u0116\u0117\u1e1e\u1e1f\u01e4\u01e5\u0126\u0127\u0268\u0197\u0248\u0249\ua740\ua741\u019a\u023d\u022e\u022f\u2c63\u1d7d\u1e56\u1e57\ua756\ua757\u024c\u024d\u1e60\u1e61\u0166\u0167\u0244\u0289\u024e\u024f\u01b5\u01b6\u1ec8\u1ec9\u1ece\u1ecf\u1e9a\u1ea0\u1ea1\u1eb8\u1eb9\u1eca\u1ecb\u1ecc\u1ecd\u1ee4\u1ee5\u1e88\u1e89\u1ef4\u1ef5\u1e5a\u1e5b\u00c1\u00e1\u00c9\u00e9\u00cd\u00ed\u00d3\u00f3\u00da\u00fa\u00dd\u00fd\u00c5\u00e5\u00c2\u00e2\u00ca\u00ea\u00d4\u00f4\u0102\u0103\u0114\u0115\u014e\u014f\u016c\u016d\u0206\u0207\u020e\u020f\u0216\u0217\u0100\u0101\u0112\u0113\u1e20\u1e21\u012a\u012b\u014c\u014d\u016a\u016b\u0232\u0233\u00c4\u00e4\u00cb\u00eb\u00cf\u00ef\u00d6\u00f6\u00dc\u00fc\u1e84\u1e85\u0178\u00ff\u0200\u0201\u0204\u0205\u0214\u0215\u0150\u0151\u00c0\u00e0\u00c8\u00e8\u00cc\u00ec\u00d2\u00f2\u00d9\u00f9\u1e80\u1e81\u1ef2\u1ef3\u00c7\u00e7\u015e\u015f\u0162\u0163\u1e6e\u1e6f\u1e94\u1e95]/.test(p1)==true || /[\u0300-\u036f\u0226\u0227\u0243\u0180\u010a\u010b\u0110\u0111\u0116\u0117\u1e1e\u1e1f\u01e4\u01e5\u0126\u0127\u0268\u0197\u0248\u0249\ua740\ua741\u019a\u023d\u022e\u022f\u2c63\u1d7d\u1e56\u1e57\ua756\ua757\u024c\u024d\u1e60\u1e61\u0166\u0167\u0244\u0289\u024e\u024f\u01b5\u01b6\u1ec8\u1ec9\u1ece\u1ecf\u1e9a\u1ea0\u1ea1\u1eb8\u1eb9\u1eca\u1ecb\u1ecc\u1ecd\u1ee4\u1ee5\u1e88\u1e89\u1ef4\u1ef5\u1e5a\u1e5b\u00c1\u00e1\u00c9\u00e9\u00cd\u00ed\u00d3\u00f3\u00da\u00fa\u00dd\u00fd\u00c5\u00e5\u00c2\u00e2\u00ca\u00ea\u00d4\u00f4\u0102\u0103\u0114\u0115\u014e\u014f\u016c\u016d\u0206\u0207\u020e\u020f\u0216\u0217\u0100\u0101\u0112\u0113\u1e20\u1e21\u012a\u012b\u014c\u014d\u016a\u016b\u0232\u0233\u00c4\u00e4\u00cb\u00eb\u00cf\u00ef\u00d6\u00f6\u00dc\u00fc\u1e84\u1e85\u0178\u00ff\u0200\u0201\u0204\u0205\u0214\u0215\u0150\u0151\u00c0\u00e0\u00c8\u00e8\u00cc\u00ec\u00d2\u00f2\u00d9\u00f9\u1e80\u1e81\u1ef2\u1ef3\u00c7\u00e7\u015e\u015f\u0162\u0163\u1e6e\u1e6f\u1e94\u1e95]/.test(p2)==true)
					return p1+p2;
				else
					return str;
			});

		s=s.replace(/[\u0300-\u036f\u207a]+/g, ""); // remove all combining diacritics and superscript plus sign
		s=s.replace(/(\u0226|\u0227|\u0243|\u0180|\u010a|\u010b|\u0110|\u0111|\u0116|\u0117|\u1e1e|\u1e1f|\u01e4|\u01e5|\u0126|\u0127|\u0268|\u0197|\u0248|\u0249|\ua740|\ua741|\u019a|\u023d|\u022e|\u022f|\u2c63|\u1d7d|\u1e56|\u1e57|\ua756|\ua757|\u024c|\u024d|\u1e60|\u1e61|\u0166|\u0167|\u0244|\u0289|\u024e|\u024f|\u01b5|\u01b6|\u1ec8|\u1ec9|\u1ece|\u1ecf|\u1e9a|\u1ea0|\u1ea1|\u1eb8|\u1eb9|\u1eca|\u1ecb|\u1ecc|\u1ecd|\u1ee4|\u1ee5|\u1e88|\u1e89|\u1ef4|\u1ef5|\u1e5a|\u1e5b|\u00c1|\u00e1|\u00c9|\u00e9|\u00cd|\u00ed|\u00d3|\u00f3|\u00da|\u00fa|\u00dd|\u00fd|\u00c5|\u00e5|\u00c2|\u00e2|\u00ca|\u00ea|\u00d4|\u00f4|\u0102|\u0103|\u0114|\u0115|\u014e|\u014f|\u016c|\u016d|\u0206|\u0207|\u020e|\u020f|\u0216|\u0217|\u0100|\u0101|\u0112|\u0113|\u1e20|\u1e21|\u012a|\u012b|\u014c|\u014d|\u016a|\u016b|\u0232|\u0233|\u00c4|\u00e4|\u00cb|\u00eb|\u00cf|\u00ef|\u00d6|\u00f6|\u00dc|\u00fc|\u1e84|\u1e85|\u0178|\u00ff|\u0200|\u0201|\u0204|\u0205|\u0214|\u0215|\u0150|\u0151|\u00c0|\u00e0|\u00c8|\u00e8|\u00cc|\u00ec|\u00d2|\u00f2|\u00d9|\u00f9|\u1e80|\u1e81|\u1ef2|\u1ef3|\u00c7|\u00e7|\u015e|\u015f|\u0162|\u0163|\u1e6e|\u1e6f|\u1e94|\u1e95)/g, function (c) {
			return uncombineMap[c];
		}); // revert precomposed letters to base letters
		return s;
	}

	return restoreString(pie);
}

